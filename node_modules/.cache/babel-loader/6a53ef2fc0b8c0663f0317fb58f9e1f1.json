{"ast":null,"code":"import _regeneratorRuntime from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component,useState}from\"react\";import{BrowserRouter,Route,Link,Navigate}from\"react-router-dom\";import dbank from'../iuh.png';import Token from'../abis/Token.json';import dBank from'../abis/dBank.json';import Web3 from'web3';var role=JSON.parse(localStorage.getItem('role'))||'';var Connect=/*#__PURE__*/function(_Component){_inherits(Connect,_Component);var _super=_createSuper(Connect);_createClass(Connect,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var web3,netId,accounts,balance,token,_dbank,dBankAddress;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(typeof window.ethereum!=='undefined')){_context.next=25;break;}web3=new Web3(window.ethereum);_context.next=4;return window.ethereum.enable();case 4:_context.next=6;return web3.eth.net.getId();case 6:netId=_context.sent;_context.next=9;return web3.eth.getAccounts();case 9:accounts=_context.sent;if(!(typeof accounts[0]!=='undefined')){_context.next=17;break;}_context.next=13;return web3.eth.getBalance(accounts[0]);case 13:balance=_context.sent;this.setState({account:accounts[0],balance:balance,web3:web3});_context.next=18;break;case 17:window.alert('Please login with MetaMask');case 18:token=new web3.eth.Contract(Token.abi,Token.networks[netId].address);_dbank=new web3.eth.Contract(dBank.abi,dBank.networks[netId].address);dBankAddress=dBank.networks[netId].address;this.setState({token:token,dbank:_dbank,dBankAddress:dBankAddress});this.state.connect=true;_context.next=26;break;case 25:window.alert('Please install MetaMask');case 26:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(_x){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()}]);function Connect(props){var _this;_classCallCheck(this,Connect);_this=_super.call(this,props);_this.login=function(e){e.preventDefault();var account=_this.state.account;return fetch('http://localhost:3000/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({account:account})}).then(function(res){if(!res.ok){throw new Error('Network response was not ok');}return res.json();}).then(function(data){localStorage.setItem(\"role\",data);window.location.reload();}).catch(function(error){console.error('Error:',error);});};_this.state={web3:'undefined',account:'',token:null,dbank:null,balance:0,dBankAddress:null,connect:false};return _this;}_createClass(Connect,[{key:\"render\",value:function render(){if(role===1){return/*#__PURE__*/React.createElement(Navigate,{to:\"/user\"});};if(role===2){return/*#__PURE__*/React.createElement(Navigate,{to:\"/admin\"});}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"nav\",{className:\"navbar navbar-primary fixed-top bg-primary flex-md-nowrap p-0 \"},/*#__PURE__*/React.createElement(\"a\",{className:\"navbar-brand col-sm-3 col-md-2 mr-0\",href:\"#\",target:\"_blank\",rel:\"noopener noreferrer\"},/*#__PURE__*/React.createElement(\"img\",{src:dbank,className:\"App-logo m-auto \",alt:\"logo\",height:\"32\"}),/*#__PURE__*/React.createElement(\"b\",{className:\"text-dark\"},\"IUHBANK\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"container-fluid mt-5 text-center\"},/*#__PURE__*/React.createElement(\"h4\",null,\"Ta\\u0300i khoa\\u0309n cu\\u0309a ba\\u0323n la\\u0300\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"form-control form-control-md\",placeholder:this.state.account,disabled:true}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"btn-primary btn\",onClick:this.login},\"Login\")));}}]);return Connect;}(Component);export{Connect as default};","map":{"version":3,"sources":["E:/2023_2024/IUH_HK2_2022_2023/LTPTDL2/dbank-master/client/src/components/Login.js"],"names":["React","Component","useState","BrowserRouter","Route","Link","Navigate","dbank","Token","dBank","Web3","role","JSON","parse","localStorage","getItem","Connect","dispatch","window","ethereum","web3","enable","eth","net","getId","netId","getAccounts","accounts","getBalance","balance","setState","account","alert","token","Contract","abi","networks","address","dBankAddress","state","connect","props","login","e","preventDefault","fetch","method","headers","body","stringify","then","res","ok","Error","json","data","setItem","location","reload","catch","error","console"],"mappings":"+kCAAA,MAAOA,CAAAA,KAAP,EAAeC,SAAf,CAA0BC,QAA1B,KAAyC,OAAzC,CACA,OACIC,aADJ,CAEIC,KAFJ,CAGIC,IAHJ,CAIIC,QAJJ,KAKM,kBALN,CAMA,MAAOC,CAAAA,KAAP,KAAkB,YAAlB,CACA,MAAOC,CAAAA,KAAP,KAAkB,oBAAlB,CACA,MAAOC,CAAAA,KAAP,KAAkB,oBAAlB,CACA,MAAOC,CAAAA,IAAP,KAAiB,MAAjB,CACA,GAAIC,CAAAA,IAAI,CAAEC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAX,GAA4C,EAAtD,C,GACqBC,CAAAA,O,kQACKC,Q,iLACrB,MAAOC,CAAAA,MAAM,CAACC,QAAd,GAA2B,W,2BACtBC,I,CAAO,GAAIV,CAAAA,IAAJ,CAASQ,MAAM,CAACC,QAAhB,C,uBACPD,CAAAA,MAAM,CAACC,QAAP,CAAgBE,MAAhB,E,8BACcD,CAAAA,IAAI,CAACE,GAAL,CAASC,GAAT,CAAaC,KAAb,E,QAAdC,K,qCACiBL,CAAAA,IAAI,CAACE,GAAL,CAASI,WAAT,E,QAAjBC,Q,oBACH,MAAOA,CAAAA,QAAQ,CAAC,CAAD,CAAf,GAAuB,W,kDACFP,CAAAA,IAAI,CAACE,GAAL,CAASM,UAAT,CAAoBD,QAAQ,CAAC,CAAD,CAA5B,C,SAAhBE,O,eACN,KAAKC,QAAL,CAAc,CAACC,OAAO,CAAEJ,QAAQ,CAAC,CAAD,CAAlB,CAAuBE,OAAO,CAAEA,OAAhC,CAAyCT,IAAI,CAAEA,IAA/C,CAAd,E,+BAEAF,MAAM,CAACc,KAAP,CAAa,4BAAb,E,QAEIC,K,CAAQ,GAAIb,CAAAA,IAAI,CAACE,GAAL,CAASY,QAAb,CAAsB1B,KAAK,CAAC2B,GAA5B,CAAiC3B,KAAK,CAAC4B,QAAN,CAAeX,KAAf,EAAsBY,OAAvD,C,CACR9B,M,CAAQ,GAAIa,CAAAA,IAAI,CAACE,GAAL,CAASY,QAAb,CAAsBzB,KAAK,CAAC0B,GAA5B,CAAiC1B,KAAK,CAAC2B,QAAN,CAAeX,KAAf,EAAsBY,OAAvD,C,CACRC,Y,CAAe7B,KAAK,CAAC2B,QAAN,CAAeX,KAAf,EAAsBY,O,CAC3C,KAAKP,QAAL,CAAc,CAACG,KAAK,CAAEA,KAAR,CAAe1B,KAAK,CAAEA,MAAtB,CAA6B+B,YAAY,CAAEA,YAA3C,CAAd,EACA,KAAKC,KAAL,CAAWC,OAAX,CAAqB,IAArB,C,+BAEAtB,MAAM,CAACc,KAAP,CAAa,yBAAb,E,+KAEF,iBAAYS,KAAZ,CAAmB,yCACjB,uBAAMA,KAAN,EADiB,MAWnBC,KAXmB,CAWX,SAACC,CAAD,CAAO,CACbA,CAAC,CAACC,cAAF,GACA,GAAIb,CAAAA,OAAO,CAAG,MAAKQ,KAAL,CAAWR,OAAzB,CACA,MAAOc,CAAAA,KAAK,CAAC,6BAAD,CAAgC,CAC1CC,MAAM,CAAE,MADkC,CAE1CC,OAAO,CAAE,CACP,eAAgB,kBADT,CAFiC,CAK1CC,IAAI,CAAEpC,IAAI,CAACqC,SAAL,CAAe,CAAClB,OAAO,CAAEA,OAAV,CAAf,CALoC,CAAhC,CAAL,CAONmB,IAPM,CAOD,SAACC,GAAD,CAAS,CACb,GAAI,CAACA,GAAG,CAACC,EAAT,CAAa,CACX,KAAM,IAAIC,CAAAA,KAAJ,CAAU,6BAAV,CAAN,CACD,CACD,MAAOF,CAAAA,GAAG,CAACG,IAAJ,EAAP,CACD,CAZM,EAaNJ,IAbM,CAaD,SAACK,IAAD,CAAU,CACdzC,YAAY,CAAC0C,OAAb,CAAqB,MAArB,CAA4BD,IAA5B,EACArC,MAAM,CAACuC,QAAP,CAAgBC,MAAhB,GACD,CAhBM,EAiBNC,KAjBM,CAiBA,SAACC,KAAD,CAAW,CAChBC,OAAO,CAACD,KAAR,CAAc,QAAd,CAAwBA,KAAxB,EACD,CAnBM,CAAP,CAoBH,CAlCoB,CAEjB,MAAKrB,KAAL,CAAa,CACXnB,IAAI,CAAE,WADK,CAEXW,OAAO,CAAE,EAFE,CAGXE,KAAK,CAAE,IAHI,CAIX1B,KAAK,CAAE,IAJI,CAKXsB,OAAO,CAAE,CALE,CAMXS,YAAY,CAAE,IANH,CAOXE,OAAO,CAAE,KAPE,CAAb,CAFiB,aAUf,C,2DAyBM,CACN,GAAG7B,IAAI,GAAK,CAAZ,CAAe,CACb,mBAAQ,oBAAC,QAAD,EAAU,EAAE,CAAE,OAAd,EAAR,CAAiC,EACnC,GAAGA,IAAI,GAAK,CAAZ,CAAe,CACX,mBAAQ,oBAAC,QAAD,EAAU,EAAE,CAAE,QAAd,EAAR,CAAkC,CACtC,mBACI,4CACE,2BAAK,SAAS,CAAC,gEAAf,eACI,yBACE,SAAS,CAAC,qCADZ,CAEE,IAAI,CAAC,GAFP,CAGE,MAAM,CAAC,QAHT,CAIE,GAAG,CAAC,qBAJN,eAME,2BAAK,GAAG,CAAEJ,KAAV,CAAiB,SAAS,CAAC,kBAA3B,CAA8C,GAAG,CAAC,MAAlD,CAAyD,MAAM,CAAC,IAAhE,EANF,cAOE,yBAAG,SAAS,CAAC,WAAb,YAPF,CADJ,CADF,cAYE,2BAAK,SAAS,CAAC,kCAAf,eACE,mFADF,cAEE,6BACE,IAAI,CAAC,MADP,CAEE,SAAS,CAAC,8BAFZ,CAGE,WAAW,CAAG,KAAKgC,KAAL,CAAWR,OAH3B,CAIE,QAAQ,KAJV,EAFF,cAQE,8BARF,cASE,8BAAQ,IAAI,CAAC,QAAb,CAAsB,SAAS,CAAC,iBAAhC,CAAkD,OAAO,CAAE,KAAKW,KAAhE,UATF,CAZF,CADJ,CA0BD,C,qBAvFgCzC,S,SAAhBe,O","sourcesContent":["import React, {Component, useState} from \"react\";\r\nimport {\r\n    BrowserRouter,\r\n    Route,\r\n    Link,\r\n    Navigate \r\n}from \"react-router-dom\";\r\nimport dbank from '../iuh.png';\r\nimport Token from '../abis/Token.json';\r\nimport dBank from '../abis/dBank.json';\r\nimport Web3 from 'web3';\r\nlet role =JSON.parse(localStorage.getItem('role'))|| ('');  \r\nexport default class Connect extends Component{\r\n  async componentDidMount(dispatch) {\r\n  if(typeof window.ethereum !== 'undefined'){\r\n    const web3 = new Web3(window.ethereum)\r\n    await window.ethereum.enable();\r\n    const netId = await web3.eth.net.getId()\r\n    const accounts = await web3.eth.getAccounts()\r\n    if(typeof accounts[0] !== 'undefined'){\r\n      const balance = await web3.eth.getBalance(accounts[0])\r\n      this.setState({account: accounts[0], balance: balance, web3: web3})\r\n    } else {\r\n      window.alert('Please login with MetaMask')\r\n    }\r\n    const token = new web3.eth.Contract(Token.abi, Token.networks[netId].address)\r\n    const dbank = new web3.eth.Contract(dBank.abi, dBank.networks[netId].address)\r\n    const dBankAddress = dBank.networks[netId].address\r\n    this.setState({token: token, dbank: dbank, dBankAddress: dBankAddress})\r\n    this.state.connect = true;\r\n  }else {\r\n    window.alert('Please install MetaMask')\r\n  }}\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      web3: 'undefined',\r\n      account: '',\r\n      token: null,\r\n      dbank: null,\r\n      balance: 0,\r\n      dBankAddress: null,\r\n      connect: false\r\n    }}\r\n  login = (e) => {\r\n    e.preventDefault();\r\n    let account = this.state.account;\r\n    return fetch('http://localhost:3000/login', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({account: account}),\r\n    })\r\n    .then((res) => {\r\n      if (!res.ok) {\r\n        throw new Error('Network response was not ok');\r\n      }\r\n      return res.json();\r\n    })\r\n    .then((data) => {\r\n      localStorage.setItem(\"role\",data);\r\n      window.location.reload();\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error:', error);\r\n    });\r\n}; \r\n    render(){\r\n      if(role === 1) {\r\n        return (<Navigate to ='/user'/>)};\r\n      if(role === 2) {\r\n          return (<Navigate to ='/admin'/>)}\r\n      return (\r\n          <div>\r\n            <nav className=\"navbar navbar-primary fixed-top bg-primary flex-md-nowrap p-0 \">\r\n                <a\r\n                  className=\"navbar-brand col-sm-3 col-md-2 mr-0\"\r\n                  href=\"#\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  <img src={dbank} className=\"App-logo m-auto \" alt=\"logo\" height=\"32\"/>\r\n                  <b className='text-dark'>IUHBANK</b>\r\n                </a>\r\n              </nav>\r\n            <div className=\"container-fluid mt-5 text-center\">\r\n              <h4>Tài khoản của bạn là</h4>\r\n              <input\r\n                type='text'\r\n                className=\"form-control form-control-md\"\r\n                placeholder= {this.state.account}\r\n                disabled\r\n              />\r\n              <br></br>\r\n              <button type=\"button\" className=\"btn-primary btn\" onClick={this.login}>Login</button>\r\n            </div>\r\n          </div>\r\n        )\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}