{"ast":null,"code":"import _regeneratorRuntime from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import{Tabs,Tab}from'react-bootstrap';import dBank from'../abis/dBank.json';import React,{Component,useState}from'react';import Token from'../abis/Token.json';import dbank from'../dbank.png';import Web3 from'web3';import{adminAccount}from'./adminaccount';import{BrowserRouter as Router,Navigate}from\"react-router-dom\";import Modal from'react-bootstrap/Modal';import Button from'react-bootstrap/Button';var room='';var user=[];var userStake=[];var modal=localStorage.getItem('modal')||'';var Begin=/*#__PURE__*/function(_Component){_inherits(Begin,_Component);var _super=_createSuper(Begin);function Begin(){_classCallCheck(this,Begin);return _super.apply(this,arguments);}_createClass(Begin,[{key:\"render\",value:function render(){if(adminAccount===2){return/*#__PURE__*/React.createElement(Admin,{socket:this.props.socket});}return/*#__PURE__*/React.createElement(Navigate,{to:\"/\"});}}]);return Begin;}(Component);export{Begin as default};function ModalShow(props){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),show=_useState2[0],setShow=_useState2[1];var handleClose=function handleClose(){return setShow(false);};var Reload=function Reload(){setShow(false);};var message=props.message;localStorage.removeItem(\"modal\");return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Modal,{show:show,onHide:handleClose},/*#__PURE__*/React.createElement(Modal.Header,{closeButton:true},/*#__PURE__*/React.createElement(Modal.Title,null,\"Modal heading\")),/*#__PURE__*/React.createElement(Modal.Body,null,message),/*#__PURE__*/React.createElement(Modal.Footer,null,/*#__PURE__*/React.createElement(Button,{variant:\"secondary\",onClick:handleClose},\"Close\"),/*#__PURE__*/React.createElement(Button,{variant:\"primary\",onClick:Reload},\"Save Changes\"))));}var Admin=/*#__PURE__*/function(_Component2){_inherits(Admin,_Component2);var _super2=_createSuper(Admin);_createClass(Admin,[{key:\"loadBlockchainData\",value:function(){var _loadBlockchainData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var web3,netId,accounts,account,balance,token,_dbank,dBankAddress,StakeAmount,index,_index;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(typeof window.ethereum!=='undefined')){_context.next=51;break;}web3=new Web3(window.ethereum);_context.next=4;return web3.eth.net.getId();case 4:netId=_context.sent;_context.next=7;return web3.eth.getAccounts();case 7:accounts=_context.sent;account=[];if(!(typeof accounts[0]!=='undefined')){_context.next=16;break;}_context.next=12;return web3.eth.getBalance(accounts[0]);case 12:balance=_context.sent;this.setState({account:accounts[0],balance:balance,web3:web3});_context.next=17;break;case 16:window.alert('Please login with MetaMask');case 17:_context.prev=17;token=new web3.eth.Contract(Token.abi,Token.networks[netId].address);_dbank=new web3.eth.Contract(dBank.abi,dBank.networks[netId].address);dBankAddress=dBank.networks[netId].address;this.setState({token:token,dbank:_dbank,dBankAddress:dBankAddress});_context.next=24;return this.state.dbank.methods.getAmountStaker().call({from:this.state.account});case 24:StakeAmount=_context.sent;index=0;case 26:if(!(index<StakeAmount)){_context.next=34;break;}_context.next=29;return this.state.dbank.methods.getStaker(index).call({from:this.state.account});case 29:_context.t0=_context.sent;this.state.staker[index]={account:_context.t0,value:0};case 31:index++;_context.next=26;break;case 34:_index=0;case 35:if(!(_index<this.state.staker.length)){_context.next=42;break;}_context.next=38;return this.state.dbank.methods.getStakeBalanceOf(this.state.staker[_index].account).call({from:this.state.account});case 38:this.state.staker[_index].value=_context.sent;case 39:_index++;_context.next=35;break;case 42:this.state.connect=true;_context.next=49;break;case 45:_context.prev=45;_context.t1=_context[\"catch\"](17);console.log('Error',_context.t1);window.alert('Contracts not deployed to the current network');case 49:_context.next=52;break;case 51:window.alert('Please install MetaMask');case 52:case\"end\":return _context.stop();}}},_callee,this,[[17,45]]);}));function loadBlockchainData(_x){return _loadBlockchainData.apply(this,arguments);}return loadBlockchainData;}()},{key:\"withstake\",value:function(){var _withstake=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(address){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(this.state.dbank!=='undefined')){_context2.next=11;break;}_context2.prev=1;_context2.next=4;return this.state.dbank.methods.withState(address).send({from:this.state.account});case 4:localStorage.setItem('modal',\"WithStake successfully\");window.location.reload();_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);// báo lỗi nếu việc lấy giá trị bị lỗi\nalert('ban khong co tien dat coc');case 11:case\"end\":return _context2.stop();}}},_callee2,this,[[1,8]]);}));function withstake(_x2){return _withstake.apply(this,arguments);}return withstake;}()},{key:\"withStateToken\",value:function(){var _withStateToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(address){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(this.state.dbank!=='undefined')){_context3.next=11;break;}_context3.prev=1;_context3.next=4;return this.state.dbank.methods.withStateToken(address).send({from:this.state.account});case 4:localStorage.setItem('modal',\"With Stake successfully\");window.location.reload();_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](1);// báo lỗi nếu việc lấy giá trị bị lỗi\nalert('ban khong co tien dat coc');case 11:case\"end\":return _context3.stop();}}},_callee3,this,[[1,8]]);}));function withStateToken(_x3){return _withStateToken.apply(this,arguments);}return withStateToken;}()}]);function Admin(props){var _this;_classCallCheck(this,Admin);_this=_super2.call(this,props);_this.state={web3:'undefined',account:'',token:null,dbank:null,balance:0,dBankAddress:null,staker:[],connect:false};return _this;}_createClass(Admin,[{key:\"ReceiveAddress\",value:function(){var _ReceiveAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this.props.socket.emit('admin','enter');this.props.socket.on('room',function(message){console.log(message);user=message;console.log(user);});if(user!=[]){localStorage.setItem('modal',\"You have a request\");}case 3:case\"end\":return _context4.stop();}}},_callee4,this);}));function ReceiveAddress(){return _ReceiveAddress.apply(this,arguments);}return ReceiveAddress;}()},{key:\"Reload\",value:function(){var _Reload=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:window.location.reload();case 1:case\"end\":return _context5.stop();}}},_callee5);}));function Reload(){return _Reload.apply(this,arguments);}return Reload;}()},{key:\"SendRequest\",value:function(){var _SendRequest=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(amount,id){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:this.props.socket.emit('userValue',{value:amount,id:id});;localStorage.setItem('modal',\"You send successfully\");window.location.reload();case 4:case\"end\":return _context6.stop();}}},_callee6,this);}));function SendRequest(_x4,_x5){return _SendRequest.apply(this,arguments);}return SendRequest;}()},{key:\"render\",value:function render(){var _this2=this;this.ReceiveAddress=this.ReceiveAddress.bind(this);return/*#__PURE__*/React.createElement(\"div\",null,modal!==''&&/*#__PURE__*/React.createElement(ModalShow,{message:modal}),/*#__PURE__*/React.createElement(\"div\",{className:\"text-monospace\"},this.state.connect==false&&/*#__PURE__*/React.createElement(\"div\",{onLoad:this.loadBlockchainData(this.props.dispatch)}),this.state.connect==true&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"nav\",{className:\"navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow\",onLoad:this.ReceiveAddress},/*#__PURE__*/React.createElement(\"a\",{className:\"navbar-brand col-sm-3 col-md-2 mr-0\",href:\"#\",target:\"_blank\",rel:\"noopener noreferrer\"},/*#__PURE__*/React.createElement(\"img\",{src:dbank,className:\"App-logo\",alt:\"logo\",height:\"32\"}),/*#__PURE__*/React.createElement(\"b\",null,\"d\\u20BFank\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"container-fluid mt-5 text-center\"},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h1\",null,\"Welcome to d\\u20BFank\"),/*#__PURE__*/React.createElement(\"h2\",null,this.state.account),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"main\",{role:\"main\",className:\"col-lg-12 d-flex text-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"content mr-auto ml-auto\"},/*#__PURE__*/React.createElement(Tabs,{defaultActiveKey:\"profile\",id:\"uncontrolled-tab-example\"},/*#__PURE__*/React.createElement(Tab,{eventKey:\"sendRequest\",title:\"Send Request\"},/*#__PURE__*/React.createElement(\"form\",null,user!=[]&&user.map(function(user){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"form-group mr-sm-2\"},/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"form-control form-control-md\",placeholder:user.id,disabled:true}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"input\",{id:\"ether\",type:\"number\",ref:function ref(input){_this2.ether=input;},className:\"form-control form-control-md\",placeholder:\"stake...\",required:true})),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"btn btn-primary\",onClick:function onClick(e){var amount=_this2.ether.value;_this2.SendRequest(amount,user.id);}},\"Send\"));}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",onClick:this.Reload,className:\"btn btn-primary\"},\"Refresh\"))),/*#__PURE__*/React.createElement(Tab,{eventKey:\"withStake\",title:\"WithStake\"},this.state.staker!=[]&&this.state.staker.map(function(staker){return/*#__PURE__*/React.createElement(\"div\",null,staker.value!=0&&/*#__PURE__*/React.createElement(\"form\",null,/*#__PURE__*/React.createElement(\"input\",{type:\"text\",value:staker.account,className:\"form-control form-control-md\",disabled:true}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",value:staker.value,className:\"form-control form-control-md\",disabled:true}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"btn btn-primary\",onClick:function onClick(e){_this2.withstake(staker.account);}},\"Withstake\")));}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"btn btn-primary\",onClick:this.Reload},\"Refresh\"))))))))));}}]);return Admin;}(Component);","map":{"version":3,"sources":["E:/2023_2024/IUH_HK2_2022_2023/LTPTDL2/dbank-master/client/src/components/admin.js"],"names":["Tabs","Tab","dBank","React","Component","useState","Token","dbank","Web3","adminAccount","BrowserRouter","Router","Navigate","Modal","Button","room","user","userStake","modal","localStorage","getItem","Begin","props","socket","ModalShow","show","setShow","handleClose","Reload","message","removeItem","Admin","dispatch","window","ethereum","web3","eth","net","getId","netId","getAccounts","accounts","account","getBalance","balance","setState","alert","token","Contract","abi","networks","address","dBankAddress","state","methods","getAmountStaker","call","from","StakeAmount","index","getStaker","staker","value","length","getStakeBalanceOf","connect","console","log","withState","send","setItem","location","reload","withStateToken","emit","on","amount","id","ReceiveAddress","bind","loadBlockchainData","map","input","ether","e","SendRequest","withstake"],"mappings":"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","sourcesContent":["import { Tabs, Tab } from 'react-bootstrap'\r\nimport dBank from '../abis/dBank.json'\r\nimport React, { Component,useState } from 'react';\r\nimport Token from '../abis/Token.json'\r\nimport dbank from '../dbank.png';\r\nimport Web3 from 'web3';\r\nimport {adminAccount} from './adminaccount';\r\nimport {BrowserRouter as Router, Navigate }from \"react-router-dom\"\r\nimport Modal from 'react-bootstrap/Modal';\r\nimport Button from 'react-bootstrap/Button';\r\nlet room = '';\r\nlet user = [];\r\nlet userStake =[];\r\nlet modal = localStorage.getItem('modal') || ('');\r\nexport default class Begin extends Component{\r\n  render (){\r\n    if(adminAccount === 2){\r\n      return <Admin socket = {this.props.socket}/>\r\n    }\r\n    return <Navigate to=\"/\" />}\r\n}\r\nfunction ModalShow(props){\r\n  const [show, setShow] = useState(true);\r\n  const handleClose = () => setShow(false);\r\n  const Reload = () =>{\r\n    setShow(false);\r\n  }\r\n  const message = props.message\r\n  localStorage.removeItem(\"modal\");\r\n  return(\r\n    <>\r\n      <Modal show={show} onHide={handleClose}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Modal heading</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>{message}</Modal.Body>\r\n        <Modal.Footer>\r\n          <Button variant=\"secondary\" onClick={handleClose}>\r\n            Close\r\n          </Button>\r\n          <Button variant=\"primary\" onClick={Reload}>\r\n            Save Changes\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n    </>)\r\n}\r\nclass Admin extends Component{ \r\n  async loadBlockchainData(dispatch) {\r\n    if(typeof window.ethereum !== 'undefined'){\r\n      const web3 = new Web3(window.ethereum)\r\n      const netId = await web3.eth.net.getId()\r\n      const accounts = await web3.eth.getAccounts()\r\n      const account =[];\r\n      \r\n      if(typeof accounts[0] !== 'undefined'){\r\n        const balance = await web3.eth.getBalance(accounts[0])\r\n        this.setState({account: accounts[0], balance: balance, web3: web3})\r\n      } else {\r\n        window.alert('Please login with MetaMask')\r\n      }\r\n      try {\r\n        const token = new web3.eth.Contract(Token.abi, Token.networks[netId].address)\r\n        const dbank = new web3.eth.Contract(dBank.abi, dBank.networks[netId].address)\r\n        const dBankAddress = dBank.networks[netId].address\r\n        this.setState({token: token, dbank: dbank, dBankAddress: dBankAddress})\r\n        let StakeAmount = await this.state.dbank.methods.getAmountStaker().call({from:this.state.account});\r\n        for (let index = 0; index < StakeAmount; index++) {\r\n          this.state.staker[index]={account:await this.state.dbank.methods.getStaker(index).call({from:this.state.account}), value: 0}\r\n        }\r\n        for (let index = 0; index < this.state.staker.length; index++) {\r\n          this.state.staker[index].value = await this.state.dbank.methods.getStakeBalanceOf(this.state.staker[index].account).call({from:this.state.account})}\r\n        \r\n        this.state.connect = true;\r\n      } catch (e) {\r\n            console.log('Error', e)\r\n            window.alert('Contracts not deployed to the current network')\r\n          }\r\n    } else {\r\n      window.alert('Please install MetaMask')\r\n    }\r\n  }\r\n  \r\n  async withstake(address) {\r\n    if(this.state.dbank!=='undefined'){\r\n      try{\r\n        // dùng để lấy ether từ account đang liên kết vào tiền gửi\r\n        await this.state.dbank.methods.withState(address).send({from: this.state.account})\r\n        localStorage.setItem('modal',\"WithStake successfully\");\r\n        window.location.reload()\r\n      } catch (e) {\r\n        // báo lỗi nếu việc lấy giá trị bị lỗi\r\n        alert('ban khong co tien dat coc');\r\n      }\r\n    }\r\n  }\r\n  async withStateToken(address) {\r\n    if(this.state.dbank!=='undefined'){\r\n      try{\r\n        // dùng để lấy ether từ account đang liên kết vào tiền gửi\r\n        await this.state.dbank.methods.withStateToken(address).send({from: this.state.account})\r\n        localStorage.setItem('modal',\"With Stake successfully\");\r\n        window.location.reload()\r\n      } catch (e) {\r\n        // báo lỗi nếu việc lấy giá trị bị lỗi\r\n        alert('ban khong co tien dat coc');\r\n      }\r\n    }\r\n  }\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      web3: 'undefined',\r\n      account: '',\r\n      token: null,\r\n      dbank: null,\r\n      balance: 0,\r\n      dBankAddress: null,\r\n      staker: [],\r\n      connect: false\r\n    }\r\n  }\r\n  async ReceiveAddress(){\r\n    this.props.socket.emit('admin','enter');\r\n    this.props.socket.on('room', (message) => {\r\n    console.log(message);\r\n    user = message;\r\n    console.log(user)\r\n  })\r\n  if(user != []){\r\n    localStorage.setItem('modal',\"You have a request\");\r\n  }\r\n} \r\n  async Reload(){\r\n    window.location.reload();\r\n  }\r\n  async SendRequest(amount,id){\r\n    {this.props.socket.emit('userValue',{\r\n    value : amount,\r\n    id: id\r\n    })};\r\n    localStorage.setItem('modal',\"You send successfully\");\r\n    window.location.reload();\r\n  }\r\n\r\n  render() {\r\n    this.ReceiveAddress = this.ReceiveAddress.bind(this);\r\n    return (<div>\r\n      {modal !== '' && <ModalShow message = {modal} />}\r\n      <div  className='text-monospace' >\r\n        {this.state.connect == false && <div onLoad={this.loadBlockchainData(this.props.dispatch)}></div>}\r\n        {this.state.connect == true && <div>\r\n          <nav className=\"navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow\" onLoad={this.ReceiveAddress}>\r\n            <a\r\n              className=\"navbar-brand col-sm-3 col-md-2 mr-0\"\r\n              href=\"#\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n            >\r\n            <img src={dbank} className=\"App-logo\" alt=\"logo\" height=\"32\"/>\r\n              <b>d₿ank</b>\r\n            </a>\r\n          </nav>\r\n          <div className=\"container-fluid mt-5 text-center\">\r\n            <br></br>\r\n            <h1>Welcome to d₿ank</h1>\r\n            <h2>{this.state.account}</h2>\r\n            <br></br>\r\n            <div className=\"row\">\r\n              <main role=\"main\" className=\"col-lg-12 d-flex text-center\">\r\n                <div className=\"content mr-auto ml-auto\">\r\n                  <Tabs defaultActiveKey=\"profile\" id=\"uncontrolled-tab-example\">\r\n                    <Tab eventKey='sendRequest' title =\"Send Request\">\r\n                      <form >\r\n                        {(user != []) && user.map(user => (\r\n                          <div>\r\n                            <div className='form-group mr-sm-2'>\r\n                              <br></br>\r\n                              <input \r\n                                type='text'\r\n                                className=\"form-control form-control-md\"\r\n                                placeholder= {user.id}\r\n                                disabled />\r\n                              <br></br>\r\n                              <input\r\n                                id='ether'\r\n                                type='number'\r\n                                ref={(input) => { this.ether = input }}\r\n                                className=\"form-control form-control-md\"\r\n                                placeholder='stake...'\r\n                                required />\r\n                            </div>\r\n                            <button type='button' className='btn btn-primary' onClick={(e) =>{\r\n                              let amount = this.ether.value\r\n                              this.SendRequest(amount,user.id)\r\n                            }} >Send</button></div>\r\n                        ))}\r\n                      <br></br>\r\n                      <button type='button' onClick={this.Reload}  className='btn btn-primary' >Refresh</button>\r\n                      </form>\r\n                    </Tab>\r\n                    {/* Chức năng withdraw */}\r\n                    <Tab eventKey=\"withStake\" title=\"WithStake\">\r\n                      {this.state.staker != [] && this.state.staker.map( staker => <div>\r\n                        {(staker.value != 0) && \r\n                        <form>\r\n                            <input\r\n                              type='text'\r\n                              value= {staker.account}\r\n                              className=\"form-control form-control-md\"\r\n                              disabled/>\r\n                            <br></br>\r\n                            <input\r\n                            type='number'\r\n                            value= {staker.value}\r\n                            className=\"form-control form-control-md\"\r\n                            disabled/>\r\n                            <br></br>\r\n                            <button type='button' className='btn btn-primary' onClick={(e) =>{\r\n                              this.withstake(staker.account);}\r\n                            }>Withstake</button>\r\n                        </form>\r\n                        }</div>)\r\n                      }\r\n                      <br></br>\r\n                      <button type='button' className='btn btn-primary' onClick={this.Reload}>Refresh</button>\r\n                    </Tab>\r\n                  </Tabs>\r\n                </div>\r\n              </main>\r\n            </div>\r\n          </div>\r\n        </div>}\r\n      </div>\r\n    </div>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}