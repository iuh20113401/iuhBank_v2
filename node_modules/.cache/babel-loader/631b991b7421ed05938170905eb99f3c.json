{"ast":null,"code":"import _regeneratorRuntime from \"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"E:\\\\2023_2024\\\\IUH_HK2_2022_2023\\\\LTPTDL2\\\\dbank-master\\\\client\\\\src\\\\components\\\\Login.js\";\nimport React, { Component, useState } from \"react\";\nimport { Navigate, useNavigate } from \"react-router-dom\";\nimport dbank from '../iuh.png';\nimport Token from '../abis/Token.json';\nimport dBank from '../abis/dBank.json';\nimport Web3 from 'web3';\nvar role = 0;\n\nvar Connect = /*#__PURE__*/function (_Component) {\n  _inherits(Connect, _Component);\n\n  var _super = _createSuper(Connect);\n\n  _createClass(Connect, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch) {\n        var web3, netId, accounts, balance, token, _dbank, dBankAddress;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(typeof window.ethereum !== 'undefined')) {\n                  _context.next = 21;\n                  break;\n                }\n\n                web3 = new Web3(window.ethereum);\n                _context.next = 4;\n                return window.ethereum.enable();\n\n              case 4:\n                _context.next = 6;\n                return web3.eth.net.getId();\n\n              case 6:\n                netId = _context.sent;\n                _context.next = 9;\n                return web3.eth.getAccounts();\n\n              case 9:\n                accounts = _context.sent;\n\n                if (!(typeof accounts[0] !== 'undefined')) {\n                  _context.next = 17;\n                  break;\n                }\n\n                _context.next = 13;\n                return web3.eth.getBalance(accounts[0]);\n\n              case 13:\n                balance = _context.sent;\n                this.setState({\n                  account: accounts[0],\n                  balance: balance,\n                  web3: web3\n                });\n                _context.next = 18;\n                break;\n\n              case 17:\n                window.alert('Please login with MetaMask');\n\n              case 18:\n                try {\n                  token = new web3.eth.Contract(Token.abi, Token.networks[netId].address);\n                  _dbank = new web3.eth.Contract(dBank.abi, dBank.networks[netId].address);\n                  dBankAddress = dBank.networks[netId].address;\n                  this.setState({\n                    token: token,\n                    dbank: _dbank,\n                    dBankAddress: dBankAddress\n                  });\n                  this.state.connect = true;\n                } catch (e) {\n                  alert(\"This network does not contain smart contract\");\n                }\n\n                _context.next = 22;\n                break;\n\n              case 21:\n                window.alert('Please install MetaMask');\n\n              case 22:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount(_x) {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }]);\n\n  function Connect(props) {\n    var _this;\n\n    _classCallCheck(this, Connect);\n\n    _this = _super.call(this, props);\n\n    _this.login = function (e) {\n      e.preventDefault();\n      var account = _this.state.account;\n      return fetch('http://localhost:3000/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          account: account\n        })\n      }).then(function (res) {\n        if (!res.ok) {\n          throw new Error('Network response was not ok');\n        }\n\n        return res.json();\n      }).then(function (data) {\n        window.location.reload();\n      }).catch(function (error) {\n        console.error('Error:', error);\n      });\n    };\n\n    _this.state = {\n      web3: 'undefined',\n      account: '',\n      token: null,\n      dbank: null,\n      balance: 0,\n      dBankAddress: null,\n      connect: false\n    };\n    return _this;\n  }\n\n  _createClass(Connect, [{\n    key: \"setRole\",\n    value: function () {\n      var _setRole = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                his.props.socket.on('role', function (message) {\n                  console.log(message);\n                  user = message;\n                  console.log(user);\n                });\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function setRole() {\n        return _setRole.apply(this, arguments);\n      }\n\n      return setRole;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (role == 1) {\n        return /*#__PURE__*/React.createElement(Navigate, {\n          to: \"/user\",\n          replace: true,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 17\n          }\n        });\n      }\n\n      ;\n\n      if (role == 2) {\n        return /*#__PURE__*/React.createElement(Navigate, {\n          to: \"/admin\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 79,\n            columnNumber: 19\n          }\n        });\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(\"nav\", {\n          className: \"navbar navbar-primary fixed-top bg-primary flex-md-nowrap p-0 \",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(\"a\", {\n          className: \"navbar-brand col-sm-3 col-md-2 mr-0\",\n          href: \"#\",\n          target: \"_blank\",\n          rel: \"noopener noreferrer\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 17\n          }\n        }, /*#__PURE__*/React.createElement(\"img\", {\n          src: dbank,\n          className: \"App-logo m-auto \",\n          alt: \"logo\",\n          height: \"32\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 19\n          }\n        }), /*#__PURE__*/React.createElement(\"b\", {\n          className: \"text-dark\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 19\n          }\n        }, \"IUHBANK\"))), /*#__PURE__*/React.createElement(\"div\", {\n          className: \"container-fluid mt-5 text-center\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(\"h4\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 15\n          }\n        }, \"Ta\\u0300i khoa\\u0309n cu\\u0309a ba\\u0323n la\\u0300\"), /*#__PURE__*/React.createElement(\"input\", {\n          type: \"text\",\n          className: \"form-control form-control-md\",\n          placeholder: this.state.account,\n          disabled: true,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 15\n          }\n        }), /*#__PURE__*/React.createElement(\"br\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 15\n          }\n        }), /*#__PURE__*/React.createElement(\"button\", {\n          type: \"button\",\n          className: \"btn-primary btn\",\n          onClick: this.login,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 15\n          }\n        }, \"Login\")));\n      }\n    }\n  }]);\n\n  return Connect;\n}(Component);\n\nexport { Connect as default };","map":{"version":3,"sources":["E:/2023_2024/IUH_HK2_2022_2023/LTPTDL2/dbank-master/client/src/components/Login.js"],"names":["React","Component","useState","Navigate","useNavigate","dbank","Token","dBank","Web3","role","Connect","dispatch","window","ethereum","web3","enable","eth","net","getId","netId","getAccounts","accounts","getBalance","balance","setState","account","alert","token","Contract","abi","networks","address","dBankAddress","state","connect","e","props","login","preventDefault","fetch","method","headers","body","JSON","stringify","then","res","ok","Error","json","data","location","reload","catch","error","console","his","socket","on","message","log","user"],"mappings":"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","sourcesContent":["import React, {Component, useState} from \"react\";\r\nimport {\r\n    Navigate, useNavigate \r\n}from \"react-router-dom\";\r\nimport dbank from '../iuh.png';\r\nimport Token from '../abis/Token.json';\r\nimport dBank from '../abis/dBank.json';\r\nimport Web3 from 'web3';\r\nlet role = 0;  \r\nexport default class Connect extends Component{\r\n  async componentDidMount(dispatch) {\r\n  if(typeof window.ethereum !== 'undefined'){\r\n    const web3 = new Web3(window.ethereum)\r\n    await window.ethereum.enable();\r\n    const netId = await web3.eth.net.getId()\r\n    const accounts = await web3.eth.getAccounts()\r\n    if(typeof accounts[0] !== 'undefined'){\r\n      const balance = await web3.eth.getBalance(accounts[0])\r\n      this.setState({account: accounts[0], balance: balance, web3: web3})\r\n    } else {\r\n      window.alert('Please login with MetaMask')\r\n    }\r\n    try{\r\n      const token = new web3.eth.Contract(Token.abi, Token.networks[netId].address)\r\n    const dbank = new web3.eth.Contract(dBank.abi, dBank.networks[netId].address)\r\n    const dBankAddress = dBank.networks[netId].address\r\n    this.setState({token: token, dbank: dbank, dBankAddress: dBankAddress})\r\n    this.state.connect = true;\r\n    }catch(e){\r\n      alert(\"This network does not contain smart contract\");\r\n    }\r\n  }else {\r\n    window.alert('Please install MetaMask')\r\n  }}\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      web3: 'undefined',\r\n      account: '',\r\n      token: null,\r\n      dbank: null,\r\n      balance: 0,\r\n      dBankAddress: null,\r\n      connect: false\r\n    }}\r\n  login = (e) => {\r\n    e.preventDefault();\r\n    let account = this.state.account;\r\n    return fetch('http://localhost:3000/login', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({account: account}),\r\n    })\r\n    .then((res) => {\r\n      if (!res.ok) {\r\n        throw new Error('Network response was not ok');\r\n      }\r\n      return res.json();\r\n    })\r\n    .then((data) => {\r\n      window.location.reload()\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error:', error);\r\n    });\r\n};  \r\nasync setRole(){\r\nhis.props.socket.on('role', (message) => {\r\n    console.log(message);\r\n    user = message;\r\n    console.log(user)\r\n  })}\r\n    render(){\r\n      if(role == 1) {\r\n        return (<Navigate to =\"/user\" replace={true} />)};\r\n      if(role == 2) {\r\n          return (<Navigate to ='/admin'/>)}\r\n      else {\r\n        return (\r\n          <div>\r\n            <nav className=\"navbar navbar-primary fixed-top bg-primary flex-md-nowrap p-0 \">\r\n                <a\r\n                  className=\"navbar-brand col-sm-3 col-md-2 mr-0\"\r\n                  href=\"#\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  <img src={dbank} className=\"App-logo m-auto \" alt=\"logo\" height=\"32\"/>\r\n                  <b className='text-dark'>IUHBANK</b>\r\n                </a>\r\n              </nav>\r\n            <div className=\"container-fluid mt-5 text-center\">\r\n              <h4>Tài khoản của bạn là</h4>\r\n              <input\r\n                type='text'\r\n                className=\"form-control form-control-md\"\r\n                placeholder= {this.state.account}\r\n                disabled\r\n              />\r\n              <br></br>\r\n              <button type=\"button\" className=\"btn-primary btn\" onClick={this.login}>Login</button>\r\n            </div>\r\n          </div>\r\n        )\r\n    }}\r\n}"]},"metadata":{},"sourceType":"module"}